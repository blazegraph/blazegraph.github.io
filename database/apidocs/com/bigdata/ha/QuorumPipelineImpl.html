<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_79) on Thu Jun 09 18:53:38 UTC 2016 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>QuorumPipelineImpl (Blazegraph Database Platform 2.1.1 API)</title>
<meta name="date" content="2016-06-09">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="QuorumPipelineImpl (Blazegraph Database Platform 2.1.1 API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/QuorumPipelineImpl.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/bigdata/ha/QuorumPipeline.html" title="interface in com.bigdata.ha"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../com/bigdata/ha/QuorumRead.html" title="interface in com.bigdata.ha"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/bigdata/ha/QuorumPipelineImpl.html" target="_top">Frames</a></li>
<li><a href="QuorumPipelineImpl.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.bigdata.ha</div>
<h2 title="Class QuorumPipelineImpl" class="title">Class QuorumPipelineImpl&lt;S extends <a href="../../../com/bigdata/ha/HAPipelineGlue.html" title="interface in com.bigdata.ha">HAPipelineGlue</a>&gt;</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>com.bigdata.ha.QuorumPipelineImpl&lt;S&gt;</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl><dt><span class="strong">Type Parameters:</span></dt><dd><code>S</code> - </dd></dl>
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../com/bigdata/ha/QuorumPipeline.html" title="interface in com.bigdata.ha">QuorumPipeline</a>&lt;S&gt;, <a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></dd>
</dl>
<hr>
<br>
<pre>public abstract class <span class="strong">QuorumPipelineImpl&lt;S extends <a href="../../../com/bigdata/ha/HAPipelineGlue.html" title="interface in com.bigdata.ha">HAPipelineGlue</a>&gt;</span>
extends <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>
implements <a href="../../../com/bigdata/ha/QuorumPipeline.html" title="interface in com.bigdata.ha">QuorumPipeline</a>&lt;S&gt;, <a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></pre>
<div class="block"><a href="../../../com/bigdata/ha/QuorumPipeline.html" title="interface in com.bigdata.ha"><code>QuorumPipeline</code></a> implementation.
 <p>
 The <a href="../../../com/bigdata/quorum/QuorumMember.html" title="interface in com.bigdata.quorum"><code>QuorumMember</code></a> must pass along the "pipeline" messages, including:
 <ul>
 <li><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineAdd()"><code>QuorumStateChangeListener.pipelineAdd()</code></a></li>
 <li><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineRemove()"><code>QuorumStateChangeListener.pipelineRemove()</code></a></li>
 <li><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineChange(java.util.UUID,%20java.util.UUID)"><code>QuorumStateChangeListener.pipelineChange(UUID, UUID)</code></a></li>
 </ul>
 When a quorum is met, the <i>leader</i> is always first in the write pipeline
 since it is the node which receives writes from clients. When a service joins
 the write pipeline, it always does so at the end of the chain. Services may
 enter the write pipeline before joining a quorum in order to synchronize with
 the quorum. If a service in the middle of the chain leaves the pipeline, then
 the upstream node will reconfigure and retransmit the current cache block to
 its new downstream node. This prevent nodes which are "bouncing" during
 synchronization from causing write sets to be discarded. However, if the
 leader leaves the write pipeline, then the quorum is broken and the write set
 will be discarded.
 <p>
 Since the write pipeline is used to synchronize services trying to join the
 quorum as well as the replicate writes for services joined with the quorum,
 <a href="../../../com/bigdata/ha/pipeline/HAReceiveService.html" title="class in com.bigdata.ha.pipeline"><code>HAReceiveService</code></a> may be live for a met quorum even though the
 <a href="../../../com/bigdata/quorum/QuorumMember.html" title="interface in com.bigdata.quorum"><code>QuorumMember</code></a> on whose behalf this class is acting is not joined with
 the met quorum.
 
 <h3>Pipeline maintenance</h3>
 
 There are three broad categories which have to be handled: (1) leader leaves;
 (2) pipeline leader election; and (3) follower leaves. A leader leave causes
 the quorum to break, which will cause service leaves and pipeline leaves for
 all joined services. However, services must add themselves to the pipeline
 before they join the quorum and the pipeline will be reorganized if necessary
 when the quorum leader is elected. This will result in a
 <a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#pipelineElectedLeader()"><code>pipelineElectedLeader()</code></a> event. A follower leave only causes the
 follower to leave the pipeline and results in a
 <a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#pipelineChange(java.util.UUID,%20java.util.UUID)"><code>pipelineChange(UUID, UUID)</code></a> event.
 <p>
 There are two cases for a follower leave: (A) when the follower did not did
 not have a downstream node; and (B) when there is downstream node. For (B),
 the upstream node from the left follower should reconfigure for the new
 downstream node and retransmit the current cache block and the event should
 be otherwise unnoticed.
 <p>
 Handling a follower join requires us to synchronize the follower first which
 requires some more infrastructure and should be done as part of the HA
 synchronization test suite.
 <p>
 What follows is an example of how events will arrive for a quorum of three
 services: A, B, and C.
 
 <pre>
 A.getActor().pipelineAdd() => A.pipelineAdd()
 B.getActor().pipelineAdd() => B.pipelineAdd(); A.pipelineChange(null,B); 
 C.getActor().pipelineAdd() => C.pipelineAdd(); B.pipelineChange(null,C);
 </pre>
 
 At this point the pipeline order is <code>[A,B,C]</code>. Notice that the
 <a href="../../../com/bigdata/ha/pipeline/HASendService.html" title="class in com.bigdata.ha.pipeline"><code>HASendService</code></a> for A is not established until the
 <code>A.pipelineChange(null,B)</code> sets B as the new downstream service
 for A. Likewise, B will not relay to C until it handles the
 <code>B.pipelineChange(null,C)</code> event.
 
 <p>
 
 Given the pipeline order <code>[A,B,C]</code>, if B were to leave, then the
 events would be:
 
 <pre>
 B.getActor().pipelineRemove() => B.pipelineRemove(); A.pipelineChange(B,C);
 </pre>
 
 and when this class handles the <code>A.pipelineChange(B,C)</code> event, it
 must update the <a href="../../../com/bigdata/ha/pipeline/HAReceiveService.html" title="class in com.bigdata.ha.pipeline"><code>HAReceiveService</code></a> such that it now relays data to C.
 
 <p>
 
 On the other hand, given the pipeline order <code>[A,B,C]</code>, if C were
 to leave the events would be:
 
 <pre>
 C.getActor().pipelineRemove() => C.pipelineRemove(); B.pipelineChange(C,null);
 </pre>
 
 and when this class handles the <code>B.pipelineChange(C,null)</code> event,
 it must update the C's <a href="../../../com/bigdata/ha/pipeline/HAReceiveService.html" title="class in com.bigdata.ha.pipeline"><code>HAReceiveService</code></a> such that it continues to
 receive data, but no longer relays data to a downstream service.</div>
<dl><dt><span class="strong">Author:</span></dt>
  <dd><a href="mailto:thompsonbry@users.sourceforge.net">Bryan Thompson</a></dd>
<dt><span class="strong">See Also:</span></dt><dd><a href="http://sourceforge.net/apps/trac/bigdata/ticket/681" > 
 HAJournalServer deadlock: pipelineRemove() and getLeaderId() </a></dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#QuorumPipelineImpl(com.bigdata.quorum.QuorumMember)">QuorumPipelineImpl</a></strong>(<a href="../../../com/bigdata/quorum/QuorumMember.html" title="interface in com.bigdata.quorum">QuorumMember</a>&lt;<a href="../../../com/bigdata/ha/QuorumPipelineImpl.html" title="type parameter in QuorumPipelineImpl">S</a>&gt;&nbsp;member)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#consensus(long)">consensus</a></strong>(long&nbsp;lastCommitTime)</code>
<div class="block">Invoked when a consensus has been achieved among <code>(k+1)/2</code>
 services concerning a shared lastCommitTime (really, this is not a
 consensus but a simple majority).</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#finalize()">finalize</a></strong>()</code>
<div class="block">Extended to invoke <code>#tearDown()</code> in order to guarantee the eventual
 release of the <a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#receiveBuffer"><code>receiveBuffer</code></a> and the shutdown of the
 <a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#sendService"><code>sendService</code></a> or <a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#receiveService"><code>receiveService</code></a>.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected long</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#getRetrySendTimeoutNanos()">getRetrySendTimeoutNanos</a></strong>()</code>
<div class="block">Once this timeout is elapsed, retrySend() will fail.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected abstract void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#handleReplicatedWrite(com.bigdata.ha.msg.IHASyncRequest,%20com.bigdata.ha.msg.IHAWriteMessage,%20java.nio.ByteBuffer)">handleReplicatedWrite</a></strong>(<a href="../../../com/bigdata/ha/msg/IHASyncRequest.html" title="interface in com.bigdata.ha.msg">IHASyncRequest</a>&nbsp;req,
                     <a href="../../../com/bigdata/ha/msg/IHAWriteMessage.html" title="interface in com.bigdata.ha.msg">IHAWriteMessage</a>&nbsp;msg,
                     <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html?is-external=true" title="class or interface in java.nio">ByteBuffer</a>&nbsp;data)</code>
<div class="block">Core implementation handles the message and payload when received on a
 service.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected abstract void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#incReceive(com.bigdata.ha.msg.IHASyncRequest,%20com.bigdata.ha.msg.IHAWriteMessage,%20int,%20int,%20int)">incReceive</a></strong>(<a href="../../../com/bigdata/ha/msg/IHASyncRequest.html" title="interface in com.bigdata.ha.msg">IHASyncRequest</a>&nbsp;req,
          <a href="../../../com/bigdata/ha/msg/IHAWriteMessage.html" title="interface in com.bigdata.ha.msg">IHAWriteMessage</a>&nbsp;msg,
          int&nbsp;nreads,
          int&nbsp;rdlen,
          int&nbsp;rem)</code>
<div class="block">Notify that some payload bytes have been incrementally received for an
 <a href="../../../com/bigdata/ha/msg/IHAMessage.html" title="interface in com.bigdata.ha.msg"><code>IHAMessage</code></a>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#lostConsensus()">lostConsensus</a></strong>()</code>
<div class="block">Invoked when the consensus is lost.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#memberAdd()">memberAdd</a></strong>()</code>
<div class="block">Invoked when this service is added as a quorum member.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#memberRemove()">memberRemove</a></strong>()</code>
<div class="block">Invoked when this service is removed as a quorum member.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#pipelineAdd()">pipelineAdd</a></strong>()</code>
<div class="block">Invoked when this service is added to the write pipeline.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#pipelineChange(java.util.UUID,%20java.util.UUID)">pipelineChange</a></strong>(<a href="http://docs.oracle.com/javase/7/docs/api/java/util/UUID.html?is-external=true" title="class or interface in java.util">UUID</a>&nbsp;oldDownStreamId,
              <a href="http://docs.oracle.com/javase/7/docs/api/java/util/UUID.html?is-external=true" title="class or interface in java.util">UUID</a>&nbsp;newDownStreamId)</code>
<div class="block">Invoked for this service when the downstream service in the write
 pipeline has changed.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#pipelineElectedLeader()">pipelineElectedLeader</a></strong>()</code>
<div class="block">Invoked for this service when the service is already in the pipeline and
 this service becomes the first service in the write pipeline because all
 previous services in the pipeline order have been removed from the
 pipeline (failover into the leader position).</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#pipelineRemove()">pipelineRemove</a></strong>()</code>
<div class="block">Invoked when this service is removed from the write pipeline.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#pipelineUpstreamChange()">pipelineUpstreamChange</a></strong>()</code>
<div class="block">Invoked for this service when the upstream service in the write pipeline
 has been removed.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#processEvents()">processEvents</a></strong>()</code>
<div class="block">Called from ErrorTask in HAJournalServer to ensure that events are
 processed before entering SeekConsensus.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#quorumBreak()">quorumBreak</a></strong>()</code>
<div class="block">Invoked when a quorum breaks.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#quorumMeet(long,%20java.util.UUID)">quorumMeet</a></strong>(long&nbsp;token,
          <a href="http://docs.oracle.com/javase/7/docs/api/java/util/UUID.html?is-external=true" title="class or interface in java.util">UUID</a>&nbsp;leaderId)</code>
<div class="block">Invoked when a quorum meets.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html?is-external=true" title="class or interface in java.util.concurrent">Future</a>&lt;<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Void.html?is-external=true" title="class or interface in java.lang">Void</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#receiveAndReplicate(com.bigdata.ha.msg.IHASyncRequest,%20com.bigdata.ha.msg.IHASendState,%20com.bigdata.ha.msg.IHAWriteMessage)">receiveAndReplicate</a></strong>(<a href="../../../com/bigdata/ha/msg/IHASyncRequest.html" title="interface in com.bigdata.ha.msg">IHASyncRequest</a>&nbsp;req,
                   <a href="../../../com/bigdata/ha/msg/IHASendState.html" title="interface in com.bigdata.ha.msg">IHASendState</a>&nbsp;snd,
                   <a href="../../../com/bigdata/ha/msg/IHAWriteMessage.html" title="interface in com.bigdata.ha.msg">IHAWriteMessage</a>&nbsp;msg)</code>
<div class="block">Return a <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html?is-external=true" title="class or interface in java.util.concurrent"><code>Future</code></a> for a task which will replicate an NIO buffer
 along the write pipeline.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html?is-external=true" title="class or interface in java.util.concurrent">Future</a>&lt;<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Void.html?is-external=true" title="class or interface in java.lang">Void</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#replicate(com.bigdata.ha.msg.IHASyncRequest,%20com.bigdata.ha.msg.IHAWriteMessage,%20java.nio.ByteBuffer)">replicate</a></strong>(<a href="../../../com/bigdata/ha/msg/IHASyncRequest.html" title="interface in com.bigdata.ha.msg">IHASyncRequest</a>&nbsp;req,
         <a href="../../../com/bigdata/ha/msg/IHAWriteMessage.html" title="interface in com.bigdata.ha.msg">IHAWriteMessage</a>&nbsp;msg,
         <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html?is-external=true" title="class or interface in java.nio">ByteBuffer</a>&nbsp;b)</code>
<div class="block">Return a <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html?is-external=true" title="class or interface in java.util.concurrent"><code>Future</code></a> for a task which will replicate an NIO buffer
 along the write pipeline.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html?is-external=true" title="class or interface in java.util.concurrent">Future</a>&lt;<a href="../../../com/bigdata/ha/IHAPipelineResetResponse.html" title="interface in com.bigdata.ha">IHAPipelineResetResponse</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#resetPipeline(com.bigdata.ha.IHAPipelineResetRequest)">resetPipeline</a></strong>(<a href="../../../com/bigdata/ha/IHAPipelineResetRequest.html" title="interface in com.bigdata.ha">IHAPipelineResetRequest</a>&nbsp;req)</code>
<div class="block">Reset the pipeline (blocking).</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#serviceJoin()">serviceJoin</a></strong>()</code>
<div class="block">Invoked when this service joins the quorum.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#serviceLeave()">serviceLeave</a></strong>()</code>
<div class="block">Invoked when this service leaves the quorum.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang">toString</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#wait(long,%20int)" title="class or interface in java.lang">wait</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_com.bigdata.ha.QuorumPipeline">
<!--   -->
</a>
<h3>Methods inherited from interface&nbsp;com.bigdata.ha.<a href="../../../com/bigdata/ha/QuorumPipeline.html" title="interface in com.bigdata.ha">QuorumPipeline</a></h3>
<code><a href="../../../com/bigdata/ha/QuorumPipeline.html#getLastCommitCounter()">getLastCommitCounter</a>, <a href="../../../com/bigdata/ha/QuorumPipeline.html#getLastCommitTime()">getLastCommitTime</a>, <a href="../../../com/bigdata/ha/QuorumPipeline.html#getStoreUUID()">getStoreUUID</a>, <a href="../../../com/bigdata/ha/QuorumPipeline.html#logRootBlock(com.bigdata.journal.IRootBlockView)">logRootBlock</a>, <a href="../../../com/bigdata/ha/QuorumPipeline.html#logWriteCacheBlock(com.bigdata.ha.msg.IHAWriteMessage,%20java.nio.ByteBuffer)">logWriteCacheBlock</a>, <a href="../../../com/bigdata/ha/QuorumPipeline.html#purgeHALogs(long)">purgeHALogs</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="QuorumPipelineImpl(com.bigdata.quorum.QuorumMember)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>QuorumPipelineImpl</h4>
<pre>public&nbsp;QuorumPipelineImpl(<a href="../../../com/bigdata/quorum/QuorumMember.html" title="interface in com.bigdata.quorum">QuorumMember</a>&lt;<a href="../../../com/bigdata/ha/QuorumPipelineImpl.html" title="type parameter in QuorumPipelineImpl">S</a>&gt;&nbsp;member)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getRetrySendTimeoutNanos()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getRetrySendTimeoutNanos</h4>
<pre>protected&nbsp;long&nbsp;getRetrySendTimeoutNanos()</pre>
<div class="block">Once this timeout is elapsed, retrySend() will fail.
 <p>
 Note: This gets overridden in the ZK aware version and set to a constant
 greater than the then-current negotiated timeout for the client.</div>
</li>
</ul>
<a name="finalize()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>finalize</h4>
<pre>protected&nbsp;void&nbsp;finalize()
                 throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang">Throwable</a></pre>
<div class="block">Extended to invoke <code>#tearDown()</code> in order to guarantee the eventual
 release of the <a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#receiveBuffer"><code>receiveBuffer</code></a> and the shutdown of the
 <a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#sendService"><code>sendService</code></a> or <a href="../../../com/bigdata/ha/QuorumPipelineImpl.html#receiveService"><code>receiveService</code></a>.</div>
<dl>
<dt><strong>Overrides:</strong></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</a></code>&nbsp;in class&nbsp;<code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></code></dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang">Throwable</a></code></dd></dl>
</li>
</ul>
<a name="pipelineAdd()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>pipelineAdd</h4>
<pre>public&nbsp;void&nbsp;pipelineAdd()</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineAdd()">QuorumStateChangeListener</a></code></strong></div>
<div class="block">Invoked when this service is added to the write pipeline. The service
 always enters at the of the pipeline.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineAdd()">pipelineAdd</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></code></dd>
</dl>
</li>
</ul>
<a name="pipelineElectedLeader()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>pipelineElectedLeader</h4>
<pre>public&nbsp;void&nbsp;pipelineElectedLeader()</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineElectedLeader()">QuorumStateChangeListener</a></code></strong></div>
<div class="block">Invoked for this service when the service is already in the pipeline and
 this service becomes the first service in the write pipeline because all
 previous services in the pipeline order have been removed from the
 pipeline (failover into the leader position).</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineElectedLeader()">pipelineElectedLeader</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></code></dd>
</dl>
</li>
</ul>
<a name="pipelineRemove()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>pipelineRemove</h4>
<pre>public&nbsp;void&nbsp;pipelineRemove()</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineRemove()">QuorumStateChangeListener</a></code></strong></div>
<div class="block">Invoked when this service is removed from the write pipeline.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineRemove()">pipelineRemove</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></code></dd>
</dl>
</li>
</ul>
<a name="pipelineChange(java.util.UUID, java.util.UUID)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>pipelineChange</h4>
<pre>public&nbsp;void&nbsp;pipelineChange(<a href="http://docs.oracle.com/javase/7/docs/api/java/util/UUID.html?is-external=true" title="class or interface in java.util">UUID</a>&nbsp;oldDownStreamId,
                  <a href="http://docs.oracle.com/javase/7/docs/api/java/util/UUID.html?is-external=true" title="class or interface in java.util">UUID</a>&nbsp;newDownStreamId)</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineChange(java.util.UUID,%20java.util.UUID)">QuorumStateChangeListener</a></code></strong></div>
<div class="block">Invoked for this service when the downstream service in the write
 pipeline has changed. Services always enter at the end of the write
 pipeline, but may be removed at any position in the write pipeline.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineChange(java.util.UUID,%20java.util.UUID)">pipelineChange</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></code></dd>
</dl>
</li>
</ul>
<a name="pipelineUpstreamChange()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>pipelineUpstreamChange</h4>
<pre>public&nbsp;void&nbsp;pipelineUpstreamChange()</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineUpstreamChange()">QuorumStateChangeListener</a></code></strong></div>
<div class="block">Invoked for this service when the upstream service in the write pipeline
 has been removed. This hook provides an opportunity for this service to
 close out its connection with the old upstream service and to prepare to
 establish a new connection with the new downstream service.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineUpstreamChange()">pipelineUpstreamChange</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></code></dd>
</dl>
</li>
</ul>
<a name="memberAdd()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>memberAdd</h4>
<pre>public&nbsp;void&nbsp;memberAdd()</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#memberAdd()">QuorumStateChangeListener</a></code></strong></div>
<div class="block">Invoked when this service is added as a quorum member.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#memberAdd()">memberAdd</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></code></dd>
</dl>
</li>
</ul>
<a name="memberRemove()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>memberRemove</h4>
<pre>public&nbsp;void&nbsp;memberRemove()</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#memberRemove()">QuorumStateChangeListener</a></code></strong></div>
<div class="block">Invoked when this service is removed as a quorum member.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#memberRemove()">memberRemove</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></code></dd>
</dl>
</li>
</ul>
<a name="consensus(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>consensus</h4>
<pre>public&nbsp;void&nbsp;consensus(long&nbsp;lastCommitTime)</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#consensus(long)">QuorumStateChangeListener</a></code></strong></div>
<div class="block">Invoked when a consensus has been achieved among <code>(k+1)/2</code>
 services concerning a shared lastCommitTime (really, this is not a
 consensus but a simple majority). This message is sent to each member
 service regardless of whether or not they participated in the consensus.
 <p>
 Once a consensus has been reached, each <a href="../../../com/bigdata/quorum/QuorumMember.html" title="interface in com.bigdata.quorum"><code>QuorumMember</code></a> which agrees
 on that <i>lastCommitTime</i> MUST do a <a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#serviceJoin()"><code>QuorumStateChangeListener.serviceJoin()</code></a> before the
 quorum will meet. The first quorum member to do a service join will be
 elected the leader. The remaining services to do a service join will be
 elected followers.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#consensus(long)">consensus</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>lastCommitTime</code> - The last commit time around which a consensus was established.</dd><dt><span class="strong">See Also:</span></dt><dd><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#serviceJoin()"><code>QuorumStateChangeListener.serviceJoin()</code></a>, 
<code>#electedLeader(long)</code>, 
<code>#electedFollower(long)</code>, 
<a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#lostConsensus()"><code>QuorumStateChangeListener.lostConsensus()</code></a></dd></dl>
</li>
</ul>
<a name="lostConsensus()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>lostConsensus</h4>
<pre>public&nbsp;void&nbsp;lostConsensus()</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#lostConsensus()">QuorumStateChangeListener</a></code></strong></div>
<div class="block">Invoked when the consensus is lost. Services do not withdraw their cast
 votes until a quorum breaks and a new consensus needs to be established.
 This message is sent to each member service regardless of whether or not
 they participated in the consensus.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#lostConsensus()">lostConsensus</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></code></dd>
<dt><span class="strong">See Also:</span></dt><dd><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#consensus(long)"><code>QuorumStateChangeListener.consensus(long)</code></a></dd></dl>
</li>
</ul>
<a name="serviceJoin()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>serviceJoin</h4>
<pre>public&nbsp;void&nbsp;serviceJoin()</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#serviceJoin()">QuorumStateChangeListener</a></code></strong></div>
<div class="block">Invoked when this service joins the quorum.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#serviceJoin()">serviceJoin</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></code></dd>
</dl>
</li>
</ul>
<a name="serviceLeave()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>serviceLeave</h4>
<pre>public&nbsp;void&nbsp;serviceLeave()</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#serviceLeave()">QuorumStateChangeListener</a></code></strong></div>
<div class="block">Invoked when this service leaves the quorum.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#serviceLeave()">serviceLeave</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></code></dd>
</dl>
</li>
</ul>
<a name="quorumMeet(long, java.util.UUID)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>quorumMeet</h4>
<pre>public&nbsp;void&nbsp;quorumMeet(long&nbsp;token,
              <a href="http://docs.oracle.com/javase/7/docs/api/java/util/UUID.html?is-external=true" title="class or interface in java.util">UUID</a>&nbsp;leaderId)</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#quorumMeet(long,%20java.util.UUID)">QuorumStateChangeListener</a></code></strong></div>
<div class="block">Invoked when a quorum meets. The state of the met quorum can be queried
 using the <i>token</i>. Quorum members can use this to decide whether
 they are the leader (using <code>#isLeader(long)</code>, joined as a
 follower (using <code>#isFollower(long)</code>), or do not participate
 in the quorum (this message is sent to all quorum members, so this
 service might not be part of the met qourum).
 <p>
 The following pre-conditions will be satisfied before this message is
 sent to the <a href="../../../com/bigdata/quorum/QuorumMember.html" title="interface in com.bigdata.quorum"><code>QuorumMember</code></a>:
 <ul>
 <li>There will be at least <code>(k+1)/2</code> services which have voted
 for the same <i>lastCommitTime</i>.</li>
 <li>There will be at <code>(k+1)/2</code> services joined with the
 quorum. The <a href="../../../com/bigdata/quorum/Quorum.html#getJoined()"><code>join order</code></a> will be the same
 as the <a href="../../../com/bigdata/quorum/Quorum.html#getVotes()"><code>Quorum.getVotes()</code></a> for the services which voted for the
 <i>lastCommitTime</li> around which a consensus was formed.</li>
 <li>If this quorum member is joined with the quorum it will have observed
 its own <a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#memberAdd()"><code>QuorumStateChangeListener.memberAdd()</code></a>, <a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#pipelineAdd()"><code>QuorumStateChangeListener.pipelineAdd()</code></a>,
 <a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#consensus(long)"><code>QuorumStateChangeListener.consensus(long)</code></a>, and <a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#serviceJoin()"><code>QuorumStateChangeListener.serviceJoin()</code></a> events.</li>
 <li>The joined services will be arranged in a write pipeline, with the
 leader at the head of that pipeline.</li>
 </ul>
 <p>
 When control returns from this method, the following post-conditions
 should be true:
 <ul>
 <li>The service should be prepared to accept reads.</li>
 <li>If the service was elected as the quorum leader, then it should be
 prepared to accept writes.</li>
 </ul>
 If the <a href="../../../com/bigdata/quorum/QuorumMember.html" title="interface in com.bigdata.quorum"><code>QuorumMember</code></a> is joined with the quorum but it can not
 satisfy these post-conditions, then it must
 <a href="../../../com/bigdata/quorum/QuorumActor.html#serviceLeave()"><code>leave</code></a> the <a href="../../../com/bigdata/quorum/Quorum.html" title="interface in com.bigdata.quorum"><code>Quorum</code></a>.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#quorumMeet(long,%20java.util.UUID)">quorumMeet</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>token</code> - The newly assigned quorum token.</dd><dd><code>leaderId</code> - The <a href="http://docs.oracle.com/javase/7/docs/api/java/util/UUID.html?is-external=true" title="class or interface in java.util"><code>UUID</code></a> of the service which was elected to be the
            quorum leader. This information is only valid for the scope of
            the accompanying quorum token. (The leaderId may be obtained
            from <code>#getLeader(long)</code> at any time for a met quorum.)</dd></dl>
</li>
</ul>
<a name="quorumBreak()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>quorumBreak</h4>
<pre>public&nbsp;void&nbsp;quorumBreak()</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#quorumBreak()">QuorumStateChangeListener</a></code></strong></div>
<div class="block">Invoked when a quorum breaks. The service MUST handle handle this event
 by (a) doing an abort() which will any buffered writes and reload their
 current root block; and (b) casting a vote for their current commit time.
 Once a consensus is reached on the current commit time, services will be
 joined in the vote order, a new leader will be elected, and the quorum
 will meet again. This message is sent to all member services, regardless
 of whether they were joined with the met quorum.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html#quorumBreak()">quorumBreak</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/quorum/QuorumStateChangeListener.html" title="interface in com.bigdata.quorum">QuorumStateChangeListener</a></code></dd>
</dl>
</li>
</ul>
<a name="resetPipeline(com.bigdata.ha.IHAPipelineResetRequest)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>resetPipeline</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html?is-external=true" title="class or interface in java.util.concurrent">Future</a>&lt;<a href="../../../com/bigdata/ha/IHAPipelineResetResponse.html" title="interface in com.bigdata.ha">IHAPipelineResetResponse</a>&gt;&nbsp;resetPipeline(<a href="../../../com/bigdata/ha/IHAPipelineResetRequest.html" title="interface in com.bigdata.ha">IHAPipelineResetRequest</a>&nbsp;req)
                                               throws <a href="http://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/ha/QuorumPipeline.html#resetPipeline(com.bigdata.ha.IHAPipelineResetRequest)">QuorumPipeline</a></code></strong></div>
<div class="block">Reset the pipeline (blocking). This message is used to handle an error in
 pipeline replication. If replication fails, the socket connections both
 upstream and downstream of the point of failure can be left in an
 indeterminate state with partially buffered data. In order to bring the
 pipeline back into a known state (without forcing a quorum break) we
 message each service in the pipeline to reset its
 <a href="../../../com/bigdata/ha/pipeline/HAReceiveService.html" title="class in com.bigdata.ha.pipeline"><code>HAReceiveService</code></a> (including the inner <a href="../../../com/bigdata/ha/pipeline/HASendService.html" title="class in com.bigdata.ha.pipeline"><code>HASendService</code></a>). The
 next message and payload relayed from the leader will cause new socket
 connections to be established.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/ha/QuorumPipeline.html#resetPipeline(com.bigdata.ha.IHAPipelineResetRequest)">resetPipeline</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/ha/QuorumPipeline.html" title="interface in com.bigdata.ha">QuorumPipeline</a>&lt;<a href="../../../com/bigdata/ha/QuorumPipelineImpl.html" title="type parameter in QuorumPipelineImpl">S</a> extends <a href="../../../com/bigdata/ha/HAPipelineGlue.html" title="interface in com.bigdata.ha">HAPipelineGlue</a>&gt;</code></dd>
<dt><span class="strong">Returns:</span></dt><dd>The <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html?is-external=true" title="class or interface in java.util.concurrent"><code>Future</code></a> for the operation on the local service.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd></dl>
</li>
</ul>
<a name="replicate(com.bigdata.ha.msg.IHASyncRequest, com.bigdata.ha.msg.IHAWriteMessage, java.nio.ByteBuffer)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>replicate</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html?is-external=true" title="class or interface in java.util.concurrent">Future</a>&lt;<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Void.html?is-external=true" title="class or interface in java.lang">Void</a>&gt;&nbsp;replicate(<a href="../../../com/bigdata/ha/msg/IHASyncRequest.html" title="interface in com.bigdata.ha.msg">IHASyncRequest</a>&nbsp;req,
                     <a href="../../../com/bigdata/ha/msg/IHAWriteMessage.html" title="interface in com.bigdata.ha.msg">IHAWriteMessage</a>&nbsp;msg,
                     <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html?is-external=true" title="class or interface in java.nio">ByteBuffer</a>&nbsp;b)
                       throws <a href="http://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/ha/QuorumPipeline.html#replicate(com.bigdata.ha.msg.IHASyncRequest,%20com.bigdata.ha.msg.IHAWriteMessage,%20java.nio.ByteBuffer)">QuorumPipeline</a></code></strong></div>
<div class="block">Return a <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html?is-external=true" title="class or interface in java.util.concurrent"><code>Future</code></a> for a task which will replicate an NIO buffer
 along the write pipeline. This method is only invoked by the quorum
 leader. The payload is replicated to the first follower in the write
 pipeline. That follower will accept the payload (and replicate it if
 necessary) using <code>#receiveAndReplicate(IHAWriteMessage)</code>.
 <p>
 Note: The implementation of this method should be robust to changes in
 the write pipeline. Specifically, if a follower leaves the write
 pipeline, it should attempt to retransmit the message and the payload
 while allowing time for the write pipeline to be reconfigured in response
 to the related <a href="../../../com/bigdata/quorum/QuorumMember.html" title="interface in com.bigdata.quorum"><code>QuorumMember</code></a> events.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/ha/QuorumPipeline.html#replicate(com.bigdata.ha.msg.IHASyncRequest,%20com.bigdata.ha.msg.IHAWriteMessage,%20java.nio.ByteBuffer)">replicate</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/ha/QuorumPipeline.html" title="interface in com.bigdata.ha">QuorumPipeline</a>&lt;<a href="../../../com/bigdata/ha/QuorumPipelineImpl.html" title="type parameter in QuorumPipelineImpl">S</a> extends <a href="../../../com/bigdata/ha/HAPipelineGlue.html" title="interface in com.bigdata.ha">HAPipelineGlue</a>&gt;</code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>req</code> - A synchronization request (optional). This is only non-null
            when historical <a href="../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> blocks are being replayed
            down the write pipeline in order to synchronize a service.</dd><dd><code>msg</code> - The RMI metadata about the payload.</dd><dd><code>b</code> - The payload. The bytes from the position to the limit will be
            transmitted (note that the #of bytes remaining in the buffer
            MUST agree with <a href="../../../com/bigdata/ha/msg/IHAWriteMessageBase.html#getSize()"><code>IHAWriteMessageBase.getSize()</code></a>).</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd></dl>
</li>
</ul>
<a name="receiveAndReplicate(com.bigdata.ha.msg.IHASyncRequest, com.bigdata.ha.msg.IHASendState, com.bigdata.ha.msg.IHAWriteMessage)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>receiveAndReplicate</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html?is-external=true" title="class or interface in java.util.concurrent">Future</a>&lt;<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Void.html?is-external=true" title="class or interface in java.lang">Void</a>&gt;&nbsp;receiveAndReplicate(<a href="../../../com/bigdata/ha/msg/IHASyncRequest.html" title="interface in com.bigdata.ha.msg">IHASyncRequest</a>&nbsp;req,
                               <a href="../../../com/bigdata/ha/msg/IHASendState.html" title="interface in com.bigdata.ha.msg">IHASendState</a>&nbsp;snd,
                               <a href="../../../com/bigdata/ha/msg/IHAWriteMessage.html" title="interface in com.bigdata.ha.msg">IHAWriteMessage</a>&nbsp;msg)
                                 throws <a href="http://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../com/bigdata/ha/QuorumPipeline.html#receiveAndReplicate(com.bigdata.ha.msg.IHASyncRequest,%20com.bigdata.ha.msg.IHASendState,%20com.bigdata.ha.msg.IHAWriteMessage)">QuorumPipeline</a></code></strong></div>
<div class="block">Return a <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html?is-external=true" title="class or interface in java.util.concurrent"><code>Future</code></a> for a task which will replicate an NIO buffer
 along the write pipeline. This method is invoked for any node except the
 master, including the last node in the failover chain.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../com/bigdata/ha/QuorumPipeline.html#receiveAndReplicate(com.bigdata.ha.msg.IHASyncRequest,%20com.bigdata.ha.msg.IHASendState,%20com.bigdata.ha.msg.IHAWriteMessage)">receiveAndReplicate</a></code>&nbsp;in interface&nbsp;<code><a href="../../../com/bigdata/ha/QuorumPipeline.html" title="interface in com.bigdata.ha">QuorumPipeline</a>&lt;<a href="../../../com/bigdata/ha/QuorumPipelineImpl.html" title="type parameter in QuorumPipelineImpl">S</a> extends <a href="../../../com/bigdata/ha/HAPipelineGlue.html" title="interface in com.bigdata.ha">HAPipelineGlue</a>&gt;</code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>req</code> - A synchronization request (optional). This is only non-null
            when historical <a href="../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> blocks are being replayed
            down the write pipeline in order to synchronize a service.</dd><dd><code>snd</code> - Metadata about the state of the sender and potentially the
            routing of the payload along the write replication pipeline.</dd><dd><code>msg</code> - The RMI metadata about the payload.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd></dl>
</li>
</ul>
<a name="handleReplicatedWrite(com.bigdata.ha.msg.IHASyncRequest, com.bigdata.ha.msg.IHAWriteMessage, java.nio.ByteBuffer)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>handleReplicatedWrite</h4>
<pre>protected abstract&nbsp;void&nbsp;handleReplicatedWrite(<a href="../../../com/bigdata/ha/msg/IHASyncRequest.html" title="interface in com.bigdata.ha.msg">IHASyncRequest</a>&nbsp;req,
                         <a href="../../../com/bigdata/ha/msg/IHAWriteMessage.html" title="interface in com.bigdata.ha.msg">IHAWriteMessage</a>&nbsp;msg,
                         <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html?is-external=true" title="class or interface in java.nio">ByteBuffer</a>&nbsp;data)
                                       throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></pre>
<div class="block">Core implementation handles the message and payload when received on a
 service.
 <p>
 Note: Replication of the message and payload is handled by the caller.
 The implementation of this method is NOT responsible for replication.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>req</code> - The synchronization request (optional). When non-
            <code>null</code> the msg and payload are historical data.
            When <code>null</code> they are live data.</dd><dd><code>msg</code> - Metadata about a buffer containing data replicated to this
            node.</dd><dd><code>data</code> - The buffer containing the data.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="incReceive(com.bigdata.ha.msg.IHASyncRequest, com.bigdata.ha.msg.IHAWriteMessage, int, int, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>incReceive</h4>
<pre>protected abstract&nbsp;void&nbsp;incReceive(<a href="../../../com/bigdata/ha/msg/IHASyncRequest.html" title="interface in com.bigdata.ha.msg">IHASyncRequest</a>&nbsp;req,
              <a href="../../../com/bigdata/ha/msg/IHAWriteMessage.html" title="interface in com.bigdata.ha.msg">IHAWriteMessage</a>&nbsp;msg,
              int&nbsp;nreads,
              int&nbsp;rdlen,
              int&nbsp;rem)
                            throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></pre>
<div class="block">Notify that some payload bytes have been incrementally received for an
 <a href="../../../com/bigdata/ha/msg/IHAMessage.html" title="interface in com.bigdata.ha.msg"><code>IHAMessage</code></a>.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>msg</code> - The message.</dd><dd><code>nreads</code> - The number of reads performed against the upstream socket for
            this message.</dd><dd><code>rdlen</code> - The number of bytes read from the socket in this read.</dd><dd><code>rem</code> - The number of bytes remaining before the payload has been
            fully read.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="processEvents()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>processEvents</h4>
<pre>public&nbsp;void&nbsp;processEvents()</pre>
<div class="block">Called from ErrorTask in HAJournalServer to ensure that events are
 processed before entering SeekConsensus.</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="https://sourceforge.net/apps/trac/bigdata/ticket/695">
 HAJournalServer reports "follower" but is in SeekConsensus and is not
 participating in commits</a></dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/QuorumPipelineImpl.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/bigdata/ha/QuorumPipeline.html" title="interface in com.bigdata.ha"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../com/bigdata/ha/QuorumRead.html" title="interface in com.bigdata.ha"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/bigdata/ha/QuorumPipelineImpl.html" target="_top">Frames</a></li>
<li><a href="QuorumPipelineImpl.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2006&#x2013;2016 <a href="https://www.blazegraph.com/">SYSTAP, LLC DBA Blazegraph</a>. All rights reserved.</small></p>
</body>
</html>
