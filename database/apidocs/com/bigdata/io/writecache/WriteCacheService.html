<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_71) on Wed Jan 20 23:38:50 EST 2016 -->
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>WriteCacheService (Blazegraph Database Platform 2.0.0-SNAPSHOT API)</title>
<meta name="date" content="2016-01-20">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="WriteCacheService (Blazegraph Database Platform 2.0.0-SNAPSHOT API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/WriteCacheService.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/bigdata/io/writecache/WriteCacheCounters.html" title="class in com.bigdata.io.writecache"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../com/bigdata/io/writecache/WriteCacheService.AsynchronousCloseException.html" title="class in com.bigdata.io.writecache"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/bigdata/io/writecache/WriteCacheService.html" target="_top">Frames</a></li>
<li><a href="WriteCacheService.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.bigdata.io.writecache</div>
<h2 title="Class WriteCacheService" class="title">Class WriteCacheService</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>com.bigdata.io.writecache.WriteCacheService</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../../com/bigdata/io/writecache/IWriteCache.html" title="interface in com.bigdata.io.writecache">IWriteCache</a></dd>
</dl>
<dl>
<dt>Direct Known Subclasses:</dt>
<dd><a href="../../../../com/bigdata/rwstore/RWWriteCacheService.html" title="class in com.bigdata.rwstore">RWWriteCacheService</a></dd>
</dl>
<hr>
<br>
<pre>public abstract class <span class="strong">WriteCacheService</span>
extends <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>
implements <a href="../../../../com/bigdata/io/writecache/IWriteCache.html" title="interface in com.bigdata.io.writecache">IWriteCache</a></pre>
<div class="block">A <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html" title="class in com.bigdata.io.writecache"><code>WriteCacheService</code></a> is provisioned with some number of
 <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> buffers and a writer thread. Caller's populate
 <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> instances. When they are full, they are transferred to a
 queue which is drained by the thread writing on the local disk. Hooks are
 provided to wait until the current write set has been written (e.g., at a
 commit point when the cached writes must be written through to the backing
 channel). This implementation supports high availability using a write
 replication pipeline.
 <p>
 A pool of <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> instances is used. Readers test all of the
 <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> using a shared <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentMap.html?is-external=true" title="class or interface in java.util.concurrent"><code>ConcurrentMap</code></a> and will return
 immediately the desired record or <code>null</code> if the record is not in
 any of the <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> instances. Write caches remain available to
 readers until they need to be recycled as the current write cache (the one
 servicing new writes).
 <p>
 The <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html" title="class in com.bigdata.io.writecache"><code>WriteCacheService</code></a> maintains a dirty list of <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a>
 instances. A single thread handle writes onto the disk and onto the write
 replication pipeline (for HA). When the caller calls flush() on the write
 cache service it flush() the current write cache is transferred to the dirty
 list and then wait until the write cache instances now on the dirty list have
 been serviced. In order to simplify the design and the provide boundary
 conditions for HA decision making, writers block during
 <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#flush(boolean,%20long,%20java.util.concurrent.TimeUnit)"><code>flush(boolean, long, TimeUnit)</code></a>.
 <p>
 Instances of this class are used by both the <a href="../../../../com/bigdata/journal/RWStrategy.html" title="class in com.bigdata.journal"><code>RWStrategy</code></a> and the
 <a href="../../../../com/bigdata/journal/WORMStrategy.html" title="class in com.bigdata.journal"><code>WORMStrategy</code></a>. These classes differ in how they allocate space on the
 backing file and in the concurrency which they permit for writers.
 <dl>
 <dt><a href="../../../../com/bigdata/journal/WORMStrategy.html" title="class in com.bigdata.journal"><code>WORMStrategy</code></a></dt>
 <dd>The <a href="../../../../com/bigdata/journal/WORMStrategy.html" title="class in com.bigdata.journal"><code>WORMStrategy</code></a> serializes all calls to
 <code>#writeChk(long, ByteBuffer, int)</code> since it must guarantee the precise
 offset at which each record is written onto the backing file. As a
 consequence of its design, each <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> is a single contiguous
 chunk of data and is transferred directly to a known offset on the disk. This
 append only strategy makes for excellent transfer rates to the disk.</dd>
 <dt><a href="../../../../com/bigdata/journal/RWStrategy.html" title="class in com.bigdata.journal"><code>RWStrategy</code></a></dt>
 <dd>The <a href="../../../../com/bigdata/journal/RWStrategy.html" title="class in com.bigdata.journal"><code>RWStrategy</code></a> only needs to serialize the decision making about
 the offset at which the records are allocated. Since the records may be
 allocated at any location in the backing file, each <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a>
 results in a scattered write on the disk.</dd>
 </dl>
 Both the <a href="../../../../com/bigdata/journal/WORMStrategy.html" title="class in com.bigdata.journal"><code>WORMStrategy</code></a> and the <a href="../../../../com/bigdata/journal/RWStrategy.html" title="class in com.bigdata.journal"><code>RWStrategy</code></a> implementations need
 to also establish a read-write lock to prevent changes in the file extent
 from causing corrupt data for concurrent read or write operations on the
 file. See <code>#writeChk(long, ByteBuffer, int)</code> for more information on
 this issue (it is a workaround for a JVM bug).
 
 <h2>Checksums</h2>
 
 The WORM and RW buffer strategy implementations, the WriteCacheService, and
 the WriteCache all know whether or not checksums are in use. When they are,
 the buffer strategy computes the checksum and passes it down (otherwise it
 passes down a 0, which will be ignored since checksums are not enabled). The
 WriteCache adjusts its capacity by -4 when checksums are enabled and adds the
 checksum when transferring the caller's data into the WriteCache. On read,
 the WriteCache will verify the checksum if it exists and returns a new
 allocation backed by a byte[] showing only the caller's record.
 <p>
 <a href="../../../../com/bigdata/rawstore/IAddressManager.html#getByteCount(long)"><code>IAddressManager.getByteCount(long)</code></a> must be the actual on the disk
 record length, not the size of the record when it reaches the application
 layer. This on the disk length is the adjusted size after optional
 compression and with the optional checksum. Applications which assume that
 lengthOf(addr) == byte[].length will break, but that's life.
 
 <h2>ReadCache</h2>
 
 Without a hotList the readCache is managed naively by clearing any new
 readCache. This potentially results in frequently accessed records being lost
 to the cache.
 
 <h2>HotCache</h2>
 
 With the HotCache evicted readCaches hot records get transferred to hotList
 and 'old' hotCaches get added to end of readCache. Pattern is needed to pluck
 reserve hotCache from readList so that it is always possible to transfer hot
 records from the readList.
 <p>
 Start with hotCache AND hotReserve.
 
 If new reserve needed, because existing one is now used, try and compress new
 readCache into current hotCache - if won't fit, then call resetWith and lose
 those writes, cycle again, moving front hotCache to readList and compress
 that one.
 <p>
 LIMIT: If we begin with full caches with above threshold hitCounts then the
 whole list will cycle around until we hit original cache which will contain
 records with zero hitCounts - for practical purposes ignoring any concurrent
 reads.</div>
<dl><dt><span class="strong">Version:</span></dt>
  <dd>$Id$</dd>
<dt><span class="strong">Author:</span></dt>
  <dd><a href="mailto:thompsonbry@users.sourceforge.net">Bryan Thompson</a></dd>
<dt><span class="strong">See Also:</span></dt><dd><a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a></dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested_class_summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Nested Class Summary table, listing nested classes, and an explanation">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Class and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.AsynchronousCloseException.html" title="class in com.bigdata.io.writecache">WriteCacheService.AsynchronousCloseException</a></strong></code>
<div class="block">An instance of this exception is thrown if a thread notices that the
 <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html" title="class in com.bigdata.io.writecache"><code>WriteCacheService</code></a> was closed by a concurrent process.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected static org.apache.log4j.Logger</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#log">log</a></strong></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#WriteCacheService(int,%20int,%20int,%20boolean,%20int,%20int,%20int,%20boolean,%20long,%20com.bigdata.io.IReopenChannel,%20com.bigdata.quorum.Quorum,%20com.bigdata.io.writecache.IBackingReader)">WriteCacheService</a></strong>(int&nbsp;nwriteBuffers,
                 int&nbsp;minCleanListSize,
                 int&nbsp;nreadBuffers,
                 boolean&nbsp;prefixWrites,
                 int&nbsp;compactionThreshold,
                 int&nbsp;hotCacheSize,
                 int&nbsp;hotCacheThreshold,
                 boolean&nbsp;useChecksum,
                 long&nbsp;fileExtent,
                 <a href="../../../../com/bigdata/io/IReopenChannel.html" title="interface in com.bigdata.io">IReopenChannel</a>&lt;? extends <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/channels/Channel.html?is-external=true" title="class or interface in java.nio.channels">Channel</a>&gt;&nbsp;opener,
                 <a href="../../../../com/bigdata/quorum/Quorum.html" title="interface in com.bigdata.quorum">Quorum</a>&nbsp;quorum,
                 <a href="../../../../com/bigdata/io/writecache/IBackingReader.html" title="interface in com.bigdata.io.writecache">IBackingReader</a>&nbsp;reader)</code>
<div class="block">Allocates N buffers from the <a href="../../../../com/bigdata/io/DirectBufferPool.html" title="class in com.bigdata.io"><code>DirectBufferPool</code></a>.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#addrDebugInfo(long)">addrDebugInfo</a></strong>(long&nbsp;paddr)</code>
<div class="block">An array of writeCache actions is maintained that can be used
 to provide a breadcrumb of how that address has been written, saved,
 freed or removed.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#canCompact()">canCompact</a></strong>()</code>
<div class="block">Return <code>true</code> iff we are allowed to compact buffers.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#clearWrite(long,%20int)">clearWrite</a></strong>(long&nbsp;offset,
          int&nbsp;latchedAddr)</code>
<div class="block">Called to check if a write has already been flushed.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#close()">close</a></strong>()</code>
<div class="block">Permanently take the <a href="../../../../com/bigdata/io/writecache/IWriteCache.html" title="interface in com.bigdata.io.writecache"><code>IWriteCache</code></a> out of service.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#debugAddrs(long,%20int,%20char)">debugAddrs</a></strong>(long&nbsp;offset,
          int&nbsp;length,
          char&nbsp;c)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#finalized()">finalized</a></strong>()</code>
<div class="block">Ensures that <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#close()"><code>close()</code></a> is eventually invoked so the buffers can be
 returned to the <a href="../../../../com/bigdata/io/DirectBufferPool.html" title="class in com.bigdata.io"><code>DirectBufferPool</code></a>.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#flush(boolean)">flush</a></strong>(boolean&nbsp;force)</code>
<div class="block">Flush the current write set through to the backing channel.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#flush(boolean,%20long,%20java.util.concurrent.TimeUnit)">flush</a></strong>(boolean&nbsp;force,
     long&nbsp;timeout,
     <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/TimeUnit.html?is-external=true" title="class or interface in java.util.concurrent">TimeUnit</a>&nbsp;units)</code>
<div class="block">Flush the writes to the backing channel but does not force anything to
 the backing channel.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../com/bigdata/counters/CounterSet.html" title="class in com.bigdata.counters">CounterSet</a></code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#getCounters()">getCounters</a></strong>()</code>
<div class="block">Return the performance counters for the <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html" title="class in com.bigdata.io.writecache"><code>WriteCacheService</code></a>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="../../../../com/bigdata/quorum/Quorum.html" title="interface in com.bigdata.quorum">Quorum</a>&lt;<a href="../../../../com/bigdata/ha/HAPipelineGlue.html" title="interface in com.bigdata.ha">HAPipelineGlue</a>,<a href="../../../../com/bigdata/quorum/QuorumMember.html" title="interface in com.bigdata.quorum">QuorumMember</a>&lt;<a href="../../../../com/bigdata/ha/HAPipelineGlue.html" title="interface in com.bigdata.ha">HAPipelineGlue</a>&gt;&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#getQuorum()">getQuorum</a></strong>()</code>
<div class="block">The object which manages <a href="../../../../com/bigdata/quorum/Quorum.html" title="interface in com.bigdata.quorum"><code>Quorum</code></a> state changes on the behalf of
 this service.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#getSendCount()">getSendCount</a></strong>()</code>
<div class="block">Return the #of <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> blocks sent by the quorum leader to
 the first downstream follower.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#getSequence()">getSequence</a></strong>()</code>
<div class="block">Return the then current write cache block sequence number.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#installReads(com.bigdata.io.writecache.WriteCache)">installReads</a></strong>(<a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache">WriteCache</a>&nbsp;cache)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#isPresent(long)">isPresent</a></strong>(long&nbsp;addr)</code>
<div class="block">Return <code>true</code> iff the address is in the write
 cache at the moment which the write cache is checked.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>abstract <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache">WriteCache</a></code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#newWriteCache(com.bigdata.io.IBufferAccess,%20boolean,%20boolean,%20com.bigdata.io.IReopenChannel,%20long)">newWriteCache</a></strong>(<a href="../../../../com/bigdata/io/IBufferAccess.html" title="interface in com.bigdata.io">IBufferAccess</a>&nbsp;buf,
             boolean&nbsp;useChecksum,
             boolean&nbsp;bufferHasData,
             <a href="../../../../com/bigdata/io/IReopenChannel.html" title="interface in com.bigdata.io">IReopenChannel</a>&lt;? extends <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/channels/Channel.html?is-external=true" title="class or interface in java.nio.channels">Channel</a>&gt;&nbsp;opener,
             long&nbsp;fileExtent)</code>
<div class="block">Factory for <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> implementations.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Callable.html?is-external=true" title="class or interface in java.util.concurrent">Callable</a>&lt;<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Void.html?is-external=true" title="class or interface in java.lang">Void</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#newWriteTask()">newWriteTask</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html?is-external=true" title="class or interface in java.nio">ByteBuffer</a></code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#read(long,%20int)">read</a></strong>(long&nbsp;offset,
    int&nbsp;nbytes)</code>
<div class="block">This is a non-blocking query of all write cache buffers (current, clean
 and dirty).</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#reset()">reset</a></strong>()</code>
<div class="block">Reset the write cache, discarding any writes which have not been written
 through to the backing channel yet.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#resetSequence()">resetSequence</a></strong>()</code>
<div class="block">Called from <a href="../../../../com/bigdata/journal/IBufferStrategy.html#commit()"><code>IBufferStrategy.commit()</code></a> and <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#reset()"><code>reset()</code></a> to
 reset WriteCache sequence for HA synchronization.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#setExtent(long)">setExtent</a></strong>(long&nbsp;fileExtent)</code>
<div class="block">Set the extent of the file on the current <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a>.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#write(long,%20java.nio.ByteBuffer,%20int)">write</a></strong>(long&nbsp;offset,
     <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html?is-external=true" title="class or interface in java.nio">ByteBuffer</a>&nbsp;data,
     int&nbsp;chk)</code>
<div class="block">Write the record on the cache.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#write(long,%20java.nio.ByteBuffer,%20int,%20boolean,%20int)">write</a></strong>(long&nbsp;offset,
     <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html?is-external=true" title="class or interface in java.nio">ByteBuffer</a>&nbsp;data,
     int&nbsp;chk,
     boolean&nbsp;useChecksum,
     int&nbsp;latchedAddr)</code>
<div class="block">Write the record onto the cache.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#writeLargeRecord(long,%20java.nio.ByteBuffer,%20int,%20boolean)">writeLargeRecord</a></strong>(long&nbsp;offset,
                <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html?is-external=true" title="class or interface in java.nio">ByteBuffer</a>&nbsp;data,
                int&nbsp;chk,
                boolean&nbsp;useChecksum)</code>
<div class="block">Write a record whose size (when combined with the optional checksum) is
 larger than the capacity of an individual <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> buffer.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang">toString</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#wait(long,%20int)" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="log">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>log</h4>
<pre>protected static final&nbsp;org.apache.log4j.Logger log</pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="WriteCacheService(int, int, int, boolean, int, int, int, boolean, long, com.bigdata.io.IReopenChannel, com.bigdata.quorum.Quorum, com.bigdata.io.writecache.IBackingReader)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>WriteCacheService</h4>
<pre>public&nbsp;WriteCacheService(int&nbsp;nwriteBuffers,
                 int&nbsp;minCleanListSize,
                 int&nbsp;nreadBuffers,
                 boolean&nbsp;prefixWrites,
                 int&nbsp;compactionThreshold,
                 int&nbsp;hotCacheSize,
                 int&nbsp;hotCacheThreshold,
                 boolean&nbsp;useChecksum,
                 long&nbsp;fileExtent,
                 <a href="../../../../com/bigdata/io/IReopenChannel.html" title="interface in com.bigdata.io">IReopenChannel</a>&lt;? extends <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/channels/Channel.html?is-external=true" title="class or interface in java.nio.channels">Channel</a>&gt;&nbsp;opener,
                 <a href="../../../../com/bigdata/quorum/Quorum.html" title="interface in com.bigdata.quorum">Quorum</a>&nbsp;quorum,
                 <a href="../../../../com/bigdata/io/writecache/IBackingReader.html" title="interface in com.bigdata.io.writecache">IBackingReader</a>&nbsp;reader)
                  throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></pre>
<div class="block">Allocates N buffers from the <a href="../../../../com/bigdata/io/DirectBufferPool.html" title="class in com.bigdata.io"><code>DirectBufferPool</code></a>.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>nwriteBuffers</code> - The #of <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> buffers.</dd><dd><code>minCleanListSize</code> - The maximum #of <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> buffers on the
            <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#dirtyList"><code>dirtyList</code></a> before we start to evict <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a>
            buffers to the disk -or- ZERO (0) to use a default value. <br>
            Note: As a rule of thumb, you should set
            <code>maxDirtyListSize LTE nbuffers-4</code> such that we have
            at least: (1) for [current], (1) for [compactingCache], (1)
            for reserve and (1) buffer left available on the
            <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#cleanList"><code>cleanList</code></a>.</dd><dd><code>prefixWrites</code> - When <code>true</code>, the <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html" title="class in com.bigdata.io.writecache"><code>WriteCacheService</code></a> is
            supporting an RWS mode store and each <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a>
            buffer will directly encode the fileOffset of each record
            written onto the <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a>. When <code>false</code>,
            the <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html" title="class in com.bigdata.io.writecache"><code>WriteCacheService</code></a> is supporting a WORM mode store
            and the <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> buffers contain the exact data to
            be written onto the backing store.</dd><dd><code>compactionThreshold</code> - The minimum percentage of space that could be reclaimed before
            we will attempt to coalesce the records in a
            <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> buffer. When <code>100</code>, compaction
            is explicitly disabled.
            <p>
            Note: This is ignored for WORM mode backing stores since we
            can not compact the buffer in that mode.</dd><dd><code>useChecksum</code> - <code>true</code> iff record level checksums are enabled.</dd><dd><code>fileExtent</code> - The current extent of the backing file.</dd><dd><code>opener</code> - The object which knows how to (re-)open the channel to which
            cached writes are flushed.</dd><dd><code>quorumManager</code> - The object which manages <a href="../../../../com/bigdata/quorum/Quorum.html" title="interface in com.bigdata.quorum"><code>Quorum</code></a> state changes on the
            behalf of this service.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></code></dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getQuorum()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getQuorum</h4>
<pre>protected&nbsp;<a href="../../../../com/bigdata/quorum/Quorum.html" title="interface in com.bigdata.quorum">Quorum</a>&lt;<a href="../../../../com/bigdata/ha/HAPipelineGlue.html" title="interface in com.bigdata.ha">HAPipelineGlue</a>,<a href="../../../../com/bigdata/quorum/QuorumMember.html" title="interface in com.bigdata.quorum">QuorumMember</a>&lt;<a href="../../../../com/bigdata/ha/HAPipelineGlue.html" title="interface in com.bigdata.ha">HAPipelineGlue</a>&gt;&gt;&nbsp;getQuorum()</pre>
<div class="block">The object which manages <a href="../../../../com/bigdata/quorum/Quorum.html" title="interface in com.bigdata.quorum"><code>Quorum</code></a> state changes on the behalf of
 this service.</div>
</li>
</ul>
<a name="canCompact()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>canCompact</h4>
<pre>protected&nbsp;boolean&nbsp;canCompact()</pre>
<div class="block">Return <code>true</code> iff we are allowed to compact buffers. The
 default implementation of the <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> is for a Worm and can
 never compact.
 <p>
 Note: This method is package private for access by
 <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html" title="class in com.bigdata.io.writecache"><code>WriteCacheService</code></a>.</div>
</li>
</ul>
<a name="resetSequence()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>resetSequence</h4>
<pre>public&nbsp;long&nbsp;resetSequence()</pre>
<div class="block">Called from <a href="../../../../com/bigdata/journal/IBufferStrategy.html#commit()"><code>IBufferStrategy.commit()</code></a> and <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#reset()"><code>reset()</code></a> to
 reset WriteCache sequence for HA synchronization. The return value winds
 up propagated to the <a href="../../../../com/bigdata/journal/IRootBlockView.html#getBlockSequence()"><code>IRootBlockView.getBlockSequence()</code></a> field in
 the <a href="../../../../com/bigdata/journal/IRootBlockView.html" title="interface in com.bigdata.journal"><code>IRootBlockView</code></a>s.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>The value of the counter before this method was called.</dd></dl>
</li>
</ul>
<a name="getSequence()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getSequence</h4>
<pre>public&nbsp;long&nbsp;getSequence()</pre>
<div class="block">Return the then current write cache block sequence number.</div>
</li>
</ul>
<a name="newWriteTask()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>newWriteTask</h4>
<pre>protected&nbsp;<a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Callable.html?is-external=true" title="class or interface in java.util.concurrent">Callable</a>&lt;<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Void.html?is-external=true" title="class or interface in java.lang">Void</a>&gt;&nbsp;newWriteTask()</pre>
</li>
</ul>
<a name="newWriteCache(com.bigdata.io.IBufferAccess, boolean, boolean, com.bigdata.io.IReopenChannel, long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>newWriteCache</h4>
<pre>public abstract&nbsp;<a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache">WriteCache</a>&nbsp;newWriteCache(<a href="../../../../com/bigdata/io/IBufferAccess.html" title="interface in com.bigdata.io">IBufferAccess</a>&nbsp;buf,
                       boolean&nbsp;useChecksum,
                       boolean&nbsp;bufferHasData,
                       <a href="../../../../com/bigdata/io/IReopenChannel.html" title="interface in com.bigdata.io">IReopenChannel</a>&lt;? extends <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/channels/Channel.html?is-external=true" title="class or interface in java.nio.channels">Channel</a>&gt;&nbsp;opener,
                       long&nbsp;fileExtent)
                                  throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></pre>
<div class="block">Factory for <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> implementations.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>buf</code> - The backing buffer (optional).</dd><dd><code>useChecksum</code> - <code>true</code> iff record level checksums are enabled.</dd><dd><code>bufferHasData</code> - <code>true</code> iff the buffer has data to be written onto
            the local persistence store (from a replicated write).</dd><dd><code>opener</code> - The object which knows how to re-open the backing channel
            (required).</dd><dd><code>fileExtent</code> - The then current extent of the backing file.</dd>
<dt><span class="strong">Returns:</span></dt><dd>A <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> wrapping that buffer and able to write on
         that channel.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></code></dd></dl>
</li>
</ul>
<a name="reset()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>reset</h4>
<pre>public&nbsp;void&nbsp;reset()
           throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></pre>
<div class="block">Reset the write cache, discarding any writes which have not been written
 through to the backing channel yet. This method IS NOT responsible for
 discarding writes which have been written through since those are in
 general available for reading directly from the backing channel. The
 abort protocol at the <a href="../../../../com/bigdata/journal/IAtomicStore.html" title="interface in com.bigdata.journal"><code>IAtomicStore</code></a> level is responsible for
 ensuring that processes do not see old data after an abort. This is
 generally handled by re-loading the appropriate root block and
 reinitializing various things from that root block.
 <p>
 All dirty buffers are reset and transferred to the head of the clean
 list. The buffers on the clean list are NOT reset since they may contain
 valid cached reads (data which is known to be on the disk). We do not
 want to discard the read cache on reset().
 <p>
 Note: This approach deliberately does not cause any buffers belonging to
 the caller of <code>#writeChk(long, ByteBuffer, int)</code> to become part of
 the <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#cleanList"><code>cleanList</code></a>.
 <p>
 Note: <strong>You MUST set the <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#setExtent(long)"><code>file extent</code></a>
 </strong> after <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#reset()"><code>resetting</code></a> the <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html" title="class in com.bigdata.io.writecache"><code>WriteCacheService</code></a>.
 This is necessary in order to ensure that the correct file extent is
 communicated along the write replication pipeline when high availability
 is enabled.
 <p>
 Note: <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#reset()"><code>reset()</code></a> MUST NOT interrupt readers. It should only reset
 those aspects of the write cache state that are associated with writes.
 On the other hand, <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#close()"><code>close()</code></a> must close all buffers and must not
 permit readers to read from closed buffers.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html#reset()">reset</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html" title="interface in com.bigdata.io.writecache">IWriteCache</a></code></dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></code></dd></dl>
</li>
</ul>
<a name="close()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>close</h4>
<pre>public&nbsp;void&nbsp;close()</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html#close()">IWriteCache</a></code></strong></div>
<div class="block">Permanently take the <a href="../../../../com/bigdata/io/writecache/IWriteCache.html" title="interface in com.bigdata.io.writecache"><code>IWriteCache</code></a> out of service. Dirty records
 are discarded, not flushed.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html#close()">close</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html" title="interface in com.bigdata.io.writecache">IWriteCache</a></code></dd>
</dl>
</li>
</ul>
<a name="finalized()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>finalized</h4>
<pre>protected&nbsp;void&nbsp;finalized()
                  throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang">Throwable</a></pre>
<div class="block">Ensures that <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#close()"><code>close()</code></a> is eventually invoked so the buffers can be
 returned to the <a href="../../../../com/bigdata/io/DirectBufferPool.html" title="class in com.bigdata.io"><code>DirectBufferPool</code></a>.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang">Throwable</a></code></dd></dl>
</li>
</ul>
<a name="flush(boolean)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>flush</h4>
<pre>public&nbsp;void&nbsp;flush(boolean&nbsp;force)
           throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></pre>
<div class="block">Flush the current write set through to the backing channel.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html#flush(boolean)">flush</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html" title="interface in com.bigdata.io.writecache">IWriteCache</a></code></dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></code></dd></dl>
</li>
</ul>
<a name="flush(boolean, long, java.util.concurrent.TimeUnit)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>flush</h4>
<pre>public&nbsp;boolean&nbsp;flush(boolean&nbsp;force,
            long&nbsp;timeout,
            <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/TimeUnit.html?is-external=true" title="class or interface in java.util.concurrent">TimeUnit</a>&nbsp;units)
              throws <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/TimeoutException.html?is-external=true" title="class or interface in java.util.concurrent">TimeoutException</a>,
                     <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></pre>
<div class="block">Flush the writes to the backing channel but does not force anything to
 the backing channel. The caller is responsible for managing when the
 channel is forced to the disk (if it is backed by disk) and whether file
 data or file data and file metadata are forced to the disk.
 <p>
 flush() is a blocking method. At most one flush() operation may run at a
 time. The <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#current"><code>current</code></a> buffer is moved to the <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#dirtyList"><code>dirtyList</code></a>
 while holding the <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.WriteLock.html?is-external=true" title="class or interface in java.util.concurrent.locks"><code>ReentrantReadWriteLock.WriteLock</code></a> and flush() then waits until the
 dirtyList becomes empty, at which point all dirty records have been
 written through to the backing file.
 <p>
 Note: Any exception thrown from this method MUST trigger error handling
 resulting in a high-level abort() and <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#reset()"><code>reset()</code></a> of the
 <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html" title="class in com.bigdata.io.writecache"><code>WriteCacheService</code></a>.
 
 TODO flush() is currently designed to block concurrent writes() in
 order to give us clean decision boundaries for the HA write pipeline and
 also to simplify the internal locking design. Once we get HA worked out
 cleanly we should explore whether or not we can relax this constraint
 such that writes can run concurrently with flush(). That would have
 somewhat higher throughput since mutable B+Tree evictions would no longer
 cause concurrent tasks to block during the commit protocol or the file
 extent protocol. [Perhaps by associating each write set with a distinct
 sequence counter (that is incremented by both commit and abort)?]
 
 TODO Flush should order ALL <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a>'s on the dirtyList by
 their fileOffset and then evict them in that order. This reordering will
 maximize the opportunity for locality during the IOs. With a large write
 cache (multiple GBs) this reordering could substantially reduce the
 IOWait associated with flush() for a large update. Note: The reordering
 should only be performed by the leader in HA mode - the followers will
 receive the <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> blocks in the desired order and can just
 drop them onto the dirtyList.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html#flush(boolean,%20long,%20java.util.concurrent.TimeUnit)">flush</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html" title="interface in com.bigdata.io.writecache">IWriteCache</a></code></dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/TimeoutException.html?is-external=true" title="class or interface in java.util.concurrent">TimeoutException</a></code></dd>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></code> - FIXME The [force] parameter is ignored and will be removed
             shortly.</dd><dt><span class="strong">See Also:</span></dt><dd><code>WriteTask</code>, 
<a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#dirtyList"><code>dirtyList</code></a>, 
<a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#dirtyListEmpty"><code>dirtyListEmpty</code></a></dd></dl>
</li>
</ul>
<a name="setExtent(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setExtent</h4>
<pre>public&nbsp;void&nbsp;setExtent(long&nbsp;fileExtent)
               throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang">IllegalStateException</a>,
                      <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></pre>
<div class="block">Set the extent of the file on the current <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a>. The then
 current value of the extent will be communicated together with the rest
 of the <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> state if it is written onto another service
 using the write replication pipeline (HA only). The receiver will use the
 value read from the <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> message to adjust the extent of
 its backing file.
 <p>
 Note: Changes in the file extent for persistence store implementations
 MUST (a) be mutually exclusive with reads and writes on the backing file
 (due to a JVM bug); and (b) force the file data and the file metadata to
 the disk. Thus any change in the <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#fileExtent"><code>fileExtent</code></a> MUST be followed by
 a <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#flush(boolean,%20long,%20java.util.concurrent.TimeUnit)"><code>flush(boolean, long, TimeUnit)</code></a>.
 <p>
 Note: You MUST set the file extent each time you invoke <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#reset()"><code>reset()</code></a>
 so the <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html" title="class in com.bigdata.io.writecache"><code>WriteCacheService</code></a> is always aware of the correct file
 extent.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></code></dd>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang">IllegalStateException</a></code></dd></dl>
</li>
</ul>
<a name="write(long, java.nio.ByteBuffer, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>write</h4>
<pre>public&nbsp;boolean&nbsp;write(long&nbsp;offset,
            <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html?is-external=true" title="class or interface in java.nio">ByteBuffer</a>&nbsp;data,
            int&nbsp;chk)
              throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a>,
                     <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang">IllegalStateException</a></pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html#write(long,%20java.nio.ByteBuffer,%20int)">IWriteCache</a></code></strong></div>
<div class="block">Write the record on the cache. This interface DOES NOT provide any
 guarantee about the ordering of writes. Callers who require a specific
 ordering must coordinate that ordering themselves, e.g., by synchronizing
 across their writes onto the cache.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html#write(long,%20java.nio.ByteBuffer,%20int)">write</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html" title="interface in com.bigdata.io.writecache">IWriteCache</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>offset</code> - The file offset of that record in the backing file.</dd><dd><code>data</code> - The record. The bytes from the current
            <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/Buffer.html?is-external=true#position()" title="class or interface in java.nio"><code>Buffer.position()</code></a> to the
            <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/Buffer.html?is-external=true#limit()" title="class or interface in java.nio"><code>Buffer.limit()</code></a> will be written and the
            <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/Buffer.html?is-external=true#position()" title="class or interface in java.nio"><code>Buffer.position()</code></a> will be advanced to the
            <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/Buffer.html?is-external=true#limit()" title="class or interface in java.nio"><code>Buffer.limit()</code></a> . The caller may subsequently
            modify the contents of the buffer without changing the state
            of the cache (i.e., the data are copied into the cache).</dd><dd><code>chk</code> - The checksum of the <i>data</i> (optional). When checksums are
            not enabled this should be ZERO (0). When checksums are
            enabled, <code>#read(long)</code> will validate the checksum before
            returning <i>data</i>.</dd>
<dt><span class="strong">Returns:</span></dt><dd><code>true</code> iff the caller's record was transferred to the
         cache. When <code>false</code>, there is not enough room left in
         the write cache for this record.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></code></dd>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang">IllegalStateException</a></code> - If the buffer is closed.</dd></dl>
</li>
</ul>
<a name="write(long, java.nio.ByteBuffer, int, boolean, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>write</h4>
<pre>public&nbsp;boolean&nbsp;write(long&nbsp;offset,
            <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html?is-external=true" title="class or interface in java.nio">ByteBuffer</a>&nbsp;data,
            int&nbsp;chk,
            boolean&nbsp;useChecksum,
            int&nbsp;latchedAddr)
              throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a>,
                     <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang">IllegalStateException</a></pre>
<div class="block">Write the record onto the cache. If the record is too large for the cache
 buffers, then it is written synchronously onto the backing channel.
 Otherwise it is written onto a cache buffer which is lazily flushed onto
 the backing channel. Cache buffers are written in order once they are
 full. This method does not impose synchronization on writes which fit the
 capacity of a cache buffer.
 <p>
 When integrating with the <a href="../../../../com/bigdata/journal/RWStrategy.html" title="class in com.bigdata.journal"><code>RWStrategy</code></a> or the <a href="../../../../com/bigdata/journal/WORMStrategy.html" title="class in com.bigdata.journal"><code>WORMStrategy</code></a>
 there needs to be a read/write lock such that file extension is mutually
 exclusive with file read/write operations (due to a Sun bug). The caller
 can override <code>#newWriteCache(ByteBuffer, IReopenChannel)</code> to
 acquire the necessary lock (the read lock of a <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/locks/ReadWriteLock.html?is-external=true" title="class or interface in java.util.concurrent.locks"><code>ReadWriteLock</code></a>).
 This is even true when the record is too large for the cache since we
 delegate the write to a temporary <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> wrapping the
 caller's buffer.
 <p>
 Note: Any exception thrown from this method MUST trigger error handling
 resulting in a high-level abort() and <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#reset()"><code>reset()</code></a> of the
 <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html" title="class in com.bigdata.io.writecache"><code>WriteCacheService</code></a>.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>latchedAddr</code> - The latched address (RWStore only).</dd>
<dt><span class="strong">Returns:</span></dt><dd><code>true</code> since the record is always accepted by the
         <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html" title="class in com.bigdata.io.writecache"><code>WriteCacheService</code></a> (unless an exception is thrown).</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></code></dd>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang">IllegalStateException</a></code></dd><dt><span class="strong">See Also:</span></dt><dd><code>http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6371642</code></dd></dl>
</li>
</ul>
<a name="debugAddrs(long, int, char)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>debugAddrs</h4>
<pre>public&nbsp;void&nbsp;debugAddrs(long&nbsp;offset,
              int&nbsp;length,
              char&nbsp;c)</pre>
</li>
</ul>
<a name="writeLargeRecord(long, java.nio.ByteBuffer, int, boolean)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>writeLargeRecord</h4>
<pre>protected&nbsp;boolean&nbsp;writeLargeRecord(long&nbsp;offset,
                       <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html?is-external=true" title="class or interface in java.nio">ByteBuffer</a>&nbsp;data,
                       int&nbsp;chk,
                       boolean&nbsp;useChecksum)
                            throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a>,
                                   <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang">IllegalStateException</a></pre>
<div class="block">Write a record whose size (when combined with the optional checksum) is
 larger than the capacity of an individual <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> buffer. This
 operation is synchronous (to protect the ByteBuffer from concurrent
 modification by the caller). It will block until the record has been
 written.
 <p>
 This implementation will write the record onto a sequence of
 <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> objects and wait until all of those objects have been
 written through to the backing file and the optional HA write pipeline. A
 checksum will be appended after the last chunk of the record. This
 strategy works for the WORM since the bytes will be laid out in a
 contiguous region on the disk.
 <p>
 Note: For the WORM, this code MUST NOT allow the writes to proceed out of
 order or the data will not be laid out correctly on the disk !!!
 <p>
 Note: The RW store MUST NOT permit individual allocations whose size on
 the disk is greater than the capacity of an individual <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a>
 buffer (@todo Or is this Ok? Perhaps it is if the RW store holds a lock
 across the write for a large record? Maybe if we also add a low-level
 method for inserting an entry into the record map?)
 <p>
 Note: This method DOES NOT register the record with the shared
 <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html#serviceMap"><code>serviceMap</code></a>. Since the record spans multiple <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a>
 objects it can not be directly recovered without reading it from the
 backing file.
 
 <h2>Dialog on large records</h2>
 
 It seems to me that the RW store is designed to break up large records
 into multiple allocations. If we constrain the size of the largest
 allocation slot on the RW store to be the capacity of a WriteCache buffer
 (including the bytes for the checksum and other record level metadata)
 then we do not have a problem with breaking up large records for it in
 the WriteCacheService and it will automatically benefit from HA using the
 write replication logic.
 <p>
 The WORM does not have these limits on the allocation size, so it seems
 likely that breaking it up across multiple WriteCache buffer instances
 would have to be done inside of the WriteCacheService in order to prevent
 checksums from being interleaved with each WriteCache worth of data it
 emits for a large record. We can't raise this out of the
 WriteCacheService because the large record would not be replicated for
 HA.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></code></dd>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang">IllegalStateException</a></code></dd></dl>
</li>
</ul>
<a name="installReads(com.bigdata.io.writecache.WriteCache)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>installReads</h4>
<pre>public&nbsp;boolean&nbsp;installReads(<a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache">WriteCache</a>&nbsp;cache)
                     throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></code></dd></dl>
</li>
</ul>
<a name="read(long, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>read</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html?is-external=true" title="class or interface in java.nio">ByteBuffer</a>&nbsp;read(long&nbsp;offset,
              int&nbsp;nbytes)
                throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a>,
                       <a href="../../../../com/bigdata/util/ChecksumError.html" title="class in com.bigdata.util">ChecksumError</a></pre>
<div class="block">This is a non-blocking query of all write cache buffers (current, clean
 and dirty).
 <p>
 This implementation DOES NOT throw an <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang"><code>IllegalStateException</code></a> if
 the service is already closed NOR if there is an asynchronous close of
 the service. Instead it just returns <code>null</code> to indicate a
 cache miss.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html#read(long,%20int)">read</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../com/bigdata/io/writecache/IWriteCache.html" title="interface in com.bigdata.io.writecache">IWriteCache</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>offset</code> - The file offset of that record in the backing file.</dd><dd><code>nbytes</code> - The length of the record (decoded from the address by the
            caller).</dd>
<dt><span class="strong">Returns:</span></dt><dd>The data read -or- <code>null</code> iff the record does not lie
         within the <a href="../../../../com/bigdata/io/writecache/IWriteCache.html" title="interface in com.bigdata.io.writecache"><code>IWriteCache</code></a>. When non-null, this will be a
         newly allocated exact fit mutable <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html?is-external=true" title="class or interface in java.nio"><code>ByteBuffer</code></a> backed by a
         Java <code>byte[]</code>. The buffer will be flipped to prepare
         for reading (the position will be zero and the limit will be the
         #of bytes read). The data DOES NOT include the bytes used to code
         checksum even when checksums are enabled.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</a></code></dd>
<dd><code><a href="../../../../com/bigdata/util/ChecksumError.html" title="class in com.bigdata.util">ChecksumError</a></code> - if checksums are enabled and the checksum for the record
             could not be validated.</dd></dl>
</li>
</ul>
<a name="clearWrite(long, int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>clearWrite</h4>
<pre>public&nbsp;boolean&nbsp;clearWrite(long&nbsp;offset,
                 int&nbsp;latchedAddr)</pre>
<div class="block">Called to check if a write has already been flushed. This is only made if
 a write has been made to previously committed data (in the current RW
 session).
 <p>
 If dirty <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a>s are flushed in order then it does not
 matter, however, if we want to be able to combine <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a>s
 then it makes sense that there are no duplicate writes.
 <p>
 On reflection this is more likely needed since for the <a href="../../../../com/bigdata/rwstore/RWStore.html" title="class in com.bigdata.rwstore"><code>RWStore</code></a>,
 depending on session parameters, the same cached area could be
 overwritten. We could still maintain multiple writes but we need a
 guarantee of order when retrieving data from the write cache (newest
 first).
 <p>
 So the question is, whether it is better to keep cache consistent or to
 constrain with read order?</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>offset</code> - the address to check</dd></dl>
</li>
</ul>
<a name="addrDebugInfo(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>addrDebugInfo</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;addrDebugInfo(long&nbsp;paddr)</pre>
<div class="block">An array of writeCache actions is maintained that can be used
 to provide a breadcrumb of how that address has been written, saved,
 freed or removed.
 <p>
 Write errors often show up as a checksum error, so the length of
 data written to the address cab be crucial information in determining the
 root of any problem.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>address</code> - for which info requested</dd>
<dt><span class="strong">Returns:</span></dt><dd>summary of writeCache actions</dd></dl>
</li>
</ul>
<a name="isPresent(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isPresent</h4>
<pre>public&nbsp;boolean&nbsp;isPresent(long&nbsp;addr)</pre>
<div class="block">Return <code>true</code> iff the address is in the write
 cache at the moment which the write cache is checked.
 <p>
 Note: Unless the caller is holding an appropriate lock
 across this operation, the result is NOT guaranteed to
 be correct at any time other than the moment when the
 cache was tested.</div>
</li>
</ul>
<a name="getCounters()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCounters</h4>
<pre>public&nbsp;<a href="../../../../com/bigdata/counters/CounterSet.html" title="class in com.bigdata.counters">CounterSet</a>&nbsp;getCounters()</pre>
<div class="block">Return the performance counters for the <a href="../../../../com/bigdata/io/writecache/WriteCacheService.html" title="class in com.bigdata.io.writecache"><code>WriteCacheService</code></a>.</div>
</li>
</ul>
<a name="getSendCount()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getSendCount</h4>
<pre>public&nbsp;long&nbsp;getSendCount()</pre>
<div class="block">Return the #of <a href="../../../../com/bigdata/io/writecache/WriteCache.html" title="class in com.bigdata.io.writecache"><code>WriteCache</code></a> blocks sent by the quorum leader to
 the first downstream follower.</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/WriteCacheService.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/bigdata/io/writecache/WriteCacheCounters.html" title="class in com.bigdata.io.writecache"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../com/bigdata/io/writecache/WriteCacheService.AsynchronousCloseException.html" title="class in com.bigdata.io.writecache"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/bigdata/io/writecache/WriteCacheService.html" target="_top">Frames</a></li>
<li><a href="WriteCacheService.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2006&#x2013;2016 <a href="https://www.blazegraph.com/">SYSTAP, LLC DBA Blazegraph</a>. All rights reserved.</small></p>
</body>
</html>
